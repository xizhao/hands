---
title: API Routes
description: Build REST APIs with Hono and deploy to Cloudflare Workers
---

API routes let you expose your data as HTTP endpoints. They run on Cloudflare Workers for global low-latency access.

## Creating an API

API routes use [Hono](https://hono.dev), a fast web framework for edge computing:

```typescript
// src/api/index.ts
import { Hono } from 'hono';
import { sql } from '@hands/stdlib';

const app = new Hono();

app.get('/users', async (c) => {
  const users = await sql`SELECT * FROM users LIMIT 100`;
  return c.json(users);
});

app.get('/users/:id', async (c) => {
  const id = c.req.param('id');
  const user = await sql`SELECT * FROM users WHERE id = ${id}`;
  return c.json(user[0]);
});

export default app;
```

## Route patterns

### GET requests

```typescript
// List resources
app.get('/products', async (c) => {
  const products = await sql`SELECT * FROM products`;
  return c.json(products);
});

// Get single resource
app.get('/products/:id', async (c) => {
  const id = c.req.param('id');
  const product = await sql`SELECT * FROM products WHERE id = ${id}`;

  if (!product.length) {
    return c.json({ error: 'Not found' }, 404);
  }

  return c.json(product[0]);
});
```

### POST requests

```typescript
app.post('/orders', async (c) => {
  const body = await c.req.json();

  const result = await sql`
    INSERT INTO orders (customer_id, total, items)
    VALUES (${body.customerId}, ${body.total}, ${JSON.stringify(body.items)})
    RETURNING *
  `;

  return c.json(result[0], 201);
});
```

### Query parameters

```typescript
app.get('/search', async (c) => {
  const query = c.req.query('q');
  const limit = parseInt(c.req.query('limit') || '10');

  const results = await sql`
    SELECT * FROM products
    WHERE name ILIKE ${'%' + query + '%'}
    LIMIT ${limit}
  `;

  return c.json(results);
});
```

## Middleware

### CORS

```typescript
import { cors } from 'hono/cors';

app.use('/*', cors({
  origin: ['https://myapp.com', 'http://localhost:3000'],
  allowMethods: ['GET', 'POST', 'PUT', 'DELETE'],
}));
```

### Authentication

```typescript
import { bearerAuth } from 'hono/bearer-auth';

// Protect all routes
app.use('/api/*', bearerAuth({ token: process.env.API_TOKEN }));

// Or protect specific routes
app.use('/admin/*', async (c, next) => {
  const authHeader = c.req.header('Authorization');
  if (!authHeader?.startsWith('Bearer ')) {
    return c.json({ error: 'Unauthorized' }, 401);
  }

  const token = authHeader.slice(7);
  const valid = await validateToken(token);

  if (!valid) {
    return c.json({ error: 'Invalid token' }, 401);
  }

  await next();
});
```

### Logging

```typescript
import { logger } from 'hono/logger';

app.use('/*', logger());
```

## Error handling

```typescript
import { HTTPException } from 'hono/http-exception';

// Custom error handler
app.onError((err, c) => {
  if (err instanceof HTTPException) {
    return c.json({ error: err.message }, err.status);
  }

  console.error(err);
  return c.json({ error: 'Internal server error' }, 500);
});

// Throw HTTP exceptions
app.get('/users/:id', async (c) => {
  const id = c.req.param('id');
  const user = await sql`SELECT * FROM users WHERE id = ${id}`;

  if (!user.length) {
    throw new HTTPException(404, { message: 'User not found' });
  }

  return c.json(user[0]);
});
```

## File structure

Organize routes into separate files:

```
src/api/
├── index.ts      # Main router
├── users.ts      # User routes
├── orders.ts     # Order routes
└── products.ts   # Product routes
```

```typescript
// src/api/index.ts
import { Hono } from 'hono';
import users from './users';
import orders from './orders';
import products from './products';

const app = new Hono();

app.route('/users', users);
app.route('/orders', orders);
app.route('/products', products);

export default app;
```

```typescript
// src/api/users.ts
import { Hono } from 'hono';
import { sql } from '@hands/stdlib';

const app = new Hono();

app.get('/', async (c) => {
  const users = await sql`SELECT * FROM users`;
  return c.json(users);
});

app.get('/:id', async (c) => {
  const id = c.req.param('id');
  const user = await sql`SELECT * FROM users WHERE id = ${id}`;
  return c.json(user[0]);
});

export default app;
```

## Validation

```typescript
import { zValidator } from '@hono/zod-validator';
import { z } from 'zod';

const createUserSchema = z.object({
  name: z.string().min(1),
  email: z.string().email(),
  role: z.enum(['user', 'admin']).default('user')
});

app.post('/users', zValidator('json', createUserSchema), async (c) => {
  const data = c.req.valid('json');

  const user = await sql`
    INSERT INTO users (name, email, role)
    VALUES (${data.name}, ${data.email}, ${data.role})
    RETURNING *
  `;

  return c.json(user[0], 201);
});
```

## Testing

Test your API locally before deploying:

```typescript
import { describe, it, expect } from 'vitest';
import app from './api';

describe('API', () => {
  it('lists users', async () => {
    const res = await app.request('/users');
    expect(res.status).toBe(200);

    const users = await res.json();
    expect(Array.isArray(users)).toBe(true);
  });

  it('creates a user', async () => {
    const res = await app.request('/users', {
      method: 'POST',
      body: JSON.stringify({ name: 'Test', email: 'test@example.com' }),
      headers: { 'Content-Type': 'application/json' }
    });

    expect(res.status).toBe(201);
  });
});
```

## Next steps

- Set up [Scheduled Jobs](/apps/scheduled-jobs/) for automation
- Learn about [Deployment](/deploy/cloudflare/)
