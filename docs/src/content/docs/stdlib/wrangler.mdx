---
title: Wrangler Integration
description: Cloudflare Workers configuration and deployment
---

Hands integrates with Wrangler for deploying to Cloudflare Workers.

## Overview

When you deploy, Hands:

1. Generates a `wrangler.toml` from your `hands.config.ts`
2. Builds your application
3. Deploys using Wrangler

## Generated configuration

Hands automatically generates `wrangler.toml`:

```toml
name = "my-workbook"
main = "dist/worker.js"
compatibility_date = "2024-01-01"

# From hands.config.ts vars
[vars]
API_URL = "https://api.example.com"

# From hands.config.ts triggers
[triggers]
crons = ["0 9 * * *", "*/15 * * * *"]
```

## Manual wrangler.toml

You can also create `wrangler.toml` manually for advanced configuration:

```toml
name = "my-app"
main = "dist/worker.js"
compatibility_date = "2024-01-01"

# Custom routes
routes = [
  { pattern = "api.example.com/*", zone_name = "example.com" }
]

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "production"
database_id = "xxx-xxx-xxx"

# KV Namespace
[[kv_namespaces]]
binding = "KV"
id = "xxx-xxx-xxx"

# R2 Bucket
[[r2_buckets]]
binding = "BUCKET"
bucket_name = "my-bucket"

# Durable Objects
[[durable_objects.bindings]]
name = "COUNTER"
class_name = "Counter"

# Cron triggers
[triggers]
crons = ["0 9 * * *"]

# Environment-specific
[env.production]
vars = { ENVIRONMENT = "production" }
routes = [{ pattern = "app.example.com/*", zone_name = "example.com" }]

[env.staging]
vars = { ENVIRONMENT = "staging" }
routes = [{ pattern = "staging.example.com/*", zone_name = "example.com" }]
```

## Bindings

### D1 Database

```toml
[[d1_databases]]
binding = "DB"
database_name = "my-database"
database_id = "xxx-xxx-xxx"
```

Access in code:

```typescript
import { sql } from '@hands/stdlib';

// sql automatically uses the D1 binding
const users = await sql`SELECT * FROM users`;
```

### KV Namespace

```toml
[[kv_namespaces]]
binding = "CACHE"
id = "xxx-xxx-xxx"
```

Access in code:

```typescript
export default {
  async fetch(request, env) {
    const cached = await env.CACHE.get('key');
    if (cached) return new Response(cached);

    const data = await fetchData();
    await env.CACHE.put('key', data, { expirationTtl: 3600 });
    return new Response(data);
  }
};
```

### R2 Storage

```toml
[[r2_buckets]]
binding = "STORAGE"
bucket_name = "my-bucket"
```

Access in code:

```typescript
export default {
  async fetch(request, env) {
    // Upload
    await env.STORAGE.put('file.txt', 'contents');

    // Download
    const object = await env.STORAGE.get('file.txt');
    return new Response(object.body);
  }
};
```

## Secrets

Set secrets via Wrangler CLI:

```bash
wrangler secret put DATABASE_URL
wrangler secret put API_KEY
wrangler secret put JWT_SECRET
```

Or in Cloudflare Dashboard:
1. Workers > your Worker
2. Settings > Variables
3. Add encrypted variable

Access in code:

```typescript
const apiKey = process.env.API_KEY;
```

## Environments

### Configuration

```toml
[env.staging]
name = "my-app-staging"
vars = { ENVIRONMENT = "staging" }

[env.production]
name = "my-app"
vars = { ENVIRONMENT = "production" }
```

### Deployment

```bash
# Deploy to staging
wrangler deploy --env staging

# Deploy to production
wrangler deploy --env production
```

## Local development

Run locally with Wrangler:

```bash
wrangler dev
```

This starts a local server with:
- Hot reloading
- Local D1 database
- Local KV storage
- Simulated cron triggers

## Custom build

For custom build steps:

```toml
[build]
command = "bun run build"
watch_dir = "src"
```

Or in `package.json`:

```json
{
  "scripts": {
    "build": "bun run build:app && bun run build:worker",
    "deploy": "bun run build && wrangler deploy"
  }
}
```

## Wrangler commands

Common commands:

```bash
# Development
wrangler dev                    # Start local dev server
wrangler dev --remote           # Dev with remote resources

# Deployment
wrangler deploy                 # Deploy to Cloudflare
wrangler deploy --env staging   # Deploy to specific env

# Database (D1)
wrangler d1 create my-database  # Create D1 database
wrangler d1 execute my-database --command "SELECT * FROM users"
wrangler d1 migrations apply my-database

# Secrets
wrangler secret put API_KEY     # Set a secret
wrangler secret list            # List secrets

# Logs
wrangler tail                   # Stream live logs
wrangler tail --format pretty   # Formatted logs

# KV
wrangler kv:namespace create CACHE
wrangler kv:key put --binding=CACHE "key" "value"
```

## CI/CD

### GitHub Actions

```yaml
name: Deploy
on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: oven-sh/setup-bun@v1
      - run: bun install
      - run: bun run build
      - uses: cloudflare/wrangler-action@v3
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          # For secrets
          secrets: |
            DATABASE_URL
            API_KEY
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          API_KEY: ${{ secrets.API_KEY }}
```

## Troubleshooting

### Build errors

Check TypeScript configuration:

```bash
bun run typecheck
```

### Size limits

Workers have a 1MB limit after compression. If exceeded:

- Remove unused dependencies
- Use dynamic imports
- Split into multiple Workers

### Compatibility issues

Set the correct compatibility date:

```toml
compatibility_date = "2024-01-01"
```

Check the [Cloudflare changelog](https://developers.cloudflare.com/workers/platform/compatibility-dates/) for breaking changes.

## Reference

See the [Wrangler documentation](https://developers.cloudflare.com/workers/wrangler/) for complete configuration options.
